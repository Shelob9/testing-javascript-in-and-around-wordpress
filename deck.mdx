import { Appear, Head, Image } from "mdx-deck";
import { FullScreenCode, Invert } from "mdx-deck/layouts";
import SyntaxHighlighter from "react-syntax-highlighter/prism";
import { atomLight, atomDark } from "react-syntax-highlighter/styles/prism";
export { dark as theme } from "mdx-deck/themes";

<Head>
  <title>Presentation Title</title>
  <meta property="og:description" content="Presentation description" />
  <meta property="og:site_name" content="Presentation Title" />
  <meta property="article:published_time" content="2013-09-17T05:59:00+01:00" />
  <meta property="article:modified_time" content="2013-09-16T19:08:47+01:00" />
  <meta property="article:section" content="Article Section (React? Design?)" />
</Head>

<Image
  src='https://images.unsplash.com/photo-1559369625-a3deda175816?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1050&q=80'
  style={{
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'center',
    color: 'white',
    backgroundColor: 'black',
  }}>

# JavaScript Testing In And Aroung WordPress

</Image>

---

<Image
  src="https://pbs.twimg.com/profile_images/1044050165269766149/YyCvrqoN_400x400.jpg"
  style={{
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    color: "white",
    backgroundColor: "black"
  }}
>
  <h2>Hi I'm Josh</h2>
  <ul>
    <li>
      <a href="https://JoshPress.net">JoshPress.net</a>
    </li>
    <li>
      <a href="https://Twitter.com/Josh412">@josh412</a>
    </li>
  </ul>
</Image>

---

## Types Of Tests

---

# Types Of Tests: Unit Tests

Does A Component Work In Isolation?

---

# Types Of Tests: Integration Tests

AKA - Feature Tests

Do The Components Work Together?

---

# Types Of Tests: Acceptance Tests

AKA - End to End Tests
AKA - e2e Tests

Does the whole system work together?

---

# JavaScript Testing In And Around WordPress

## Part One: Testing React Apps

---

# How React Works

---

## Step 1

React creates an object representation of nodes representing a user interface.

- It does not produce HTML.

---

## Step 2

A "renderer" converts that object to a useable interface.

- ReactDOM renders React as DOM tree and appended to DOM.
- ReactDOMServer renders to an HTML string for server to send to client.

---

# Test Renderers

- React Test Renderer
- React Testing Library
- Enzyme

---

# The Test Suite

- Test Runner (Jest)
  - Runs the tests
- Test Renderer (react-test-library)
  - Creates and inspects output
- Assertions (Chai)
  - Tests the output

---

# Zero-Config Testing (and more)

- react-scripts
  - `react-scripts test`
- @wordpress/scripts
  - `wordpress-scripts test`

---

`npx create-react-app`

# Let's Write Some Tests

And A Web App :)

---

# Create A React App

<SyntaxHighlighter
  language="bash"
  style={atomLight}
  customStyle={{ minWidth: "500px" }}
>
  {`
# install create-react-app
npx create-react-app
# Run the included test
yarn test
  `}
</SyntaxHighlighter>

---

## Section

Create React App comes with one test.

This is an acceptance test. It tests if **anything** is broken.

---

## Test The App Renders

<SyntaxHighlighter
  language="bash"
  style={atomLight}
  customStyle={{ minWidth: "500px" }}
>
  {`
import React from 'react';
import ReactDOM from 'react-dom';
import App from './App';
it('renders without crashing', () => {
  const div = document.createElement('div');
  ReactDOM.render(<App />, div);
  ReactDOM.unmountComponentAtNode(div);
});
`}

</SyntaxHighlighter>

---

# Questions To Ask?

- How do I know the components works?
  - Unit tests
- How do I know the components work together?
  - Integration/ Feature Tests
- What is the most realistic test of the program?
  - Acceptance/ e2e Tests

---

# App Spec

Create a one page app that:

- Displays a value
- Has an input to change that value

---

# Test Spec

- Unit tests:
  - Does display component display the supplied value?
  - Does edit callback display the value
  - Does the edit component supply updated value to onChange callback?

---

# Test Spec

- Integration Tests:
  - Does the display value change with the input?

---

# Layout Of Our Test File

---

## `test()` Syntax

```jsx
//Import React
import React from "react";
//Import test renderer
import TestRenderer from "react-test-renderer";
//Import component to test
import { DisplayValue } from "./DisplayValue";

test("Component renders value", () => {});

test("Component has supplied class name", () => {});
```

---

## BDD style

```jsx
describe("EditValue component", () => {
  //Shared mock onChange function
  let onChange = jest.fn();
  beforeEach(() => {
    //Reset onChange mock before each test.
    onChange = jest.fn();
  });

  it("Has the supplied value in the input", () => {});

  it("id and for attribute match", () => {});

  it("Passes string to onChange when changed", () => {});

  it("Passes string to onChange when changed with an integer", () => {});
});
```

---

# Install React Test Renderer

<SyntaxHighlighter
  language="bash"
  style={atomLight}
  customStyle={{ minWidth: "500px" }}
>
  {`
yarn add react-test-renderer
  `}
</SyntaxHighlighter>

---

# Unit Testing React Components

---

## Find Props

<SyntaxHighlighter
  language="javascript"
  style={atomLight}
  customStyle={{ minWidth: "500px" }}
>
  {`
test( 'Component renders value', () => {
    const value = 'The Value';
    const testRenderer = TestRenderer.create(<DisplayValue value={value} />);
    const testInstance = testRenderer.root;
    expect(testInstance.findByType('div').props.children).toBe(value);
});
`}

</SyntaxHighlighter>

---

## Do This For Every Prop?

### That Is Testing React, Not Your Application

---

## Snapshot Testing

### Renders Component To JSON

Stores JSON in file system

---

## Snapshot Testing

- Snapshots Acomplish Two Things:

  - Make sure your props went to the right places.
  - Force your to **commit** to changes.

---

## Create A Snapshot Test

<SyntaxHighlighter
  language="javascript"
  style={atomLight}
  customStyle={{ minWidth: "500px" }}
>
  {`
test( 'Component renders correctly', () => {
    expect(
        TestRenderer.create(
            <DisplayValue
                value={'The Value'}
                className={'the-class-name'}
             />
        ).toJSON()
    ).toMatchSnapshot();
});
`}
</SyntaxHighlighter>

---

# Testing Events

React testing library is best for this. Enzyme is an alternative.

<SyntaxHighlighter
  language="bash"
  style={atomLight}
  customStyle={{ minWidth: "500px" }}
>
  {`
yarn add @testing-library/react
  `}
</SyntaxHighlighter>

---

## Test On Change Event

<SyntaxHighlighter
  language="javascript"
  style={atomLight}
  customStyle={{ minWidth: "500px" }}
>
  {`
describe("EditValue component", () => {
    afterEach(cleanup);
    it("Calls the onchange function", () => {
        const onChange = jest.fn();
        const { getByTestId } = render(
          <EditValue 
            onChange={onChange} 
            value={""} 
            id={'input-test'}
            className={"some-class"}  
          />);
        fireEvent.change(getByTestId("input-test"), {
            target: { value: "New Value" }
        });
        expect(onChange).toHaveBeenCalledTimes(1);
    });
    //...
});
`}

</SyntaxHighlighter>

---

## Test On Change Event

<SyntaxHighlighter
  language="javascript"
  style={atomLight}
  customStyle={{ minWidth: "500px" }}
>
  {`
describe("EditValue component", () => {
    afterEach(cleanup);
    //...
    it("Passes updated value, not event to onChange callback", () => {
        const onChange = jest.fn();
        const { getByTestId } = render(
          <EditValue 
            onChange={onChange} 
            value={""}
             id="input-test" 
             className={"some-class"}  
          />);
        fireEvent.change(getByTestId("input-test"), {
            target: { value: "New Value" }
        });
        expect(onChange).toHaveBeenCalledWith("New Value");
    });
});
`}

</SyntaxHighlighter>

---

# Snapshot Testing

<SyntaxHighlighter
  language="javascript"
  style={atomLight}
  customStyle={{ minWidth: "500px" }}
>
  {`
describe("EditValue component", () => {
    afterEach(cleanup);
     it( 'matches snapshot', () => {
        expect( 
          render(
            <EditValue 
              onChange={jest.fn()} 
              value={"Hi Roy"}
              id={'some-id'} 
              className={"some-class"}
            /> 
          )
        ).toMatchSnapshot();
    });
});
`}

</SyntaxHighlighter>

---

# Integration Tests

Do the two components work together as expected?

---

## Integration Test

<SyntaxHighlighter
  language="javascript"
  style={atomLight}
  customStyle={{ minWidth: "500px" }}
>
  {`
it( 'Displays the updated value when value changes', () => {
    const { container,getByTestId } = render(<App  />)
    expect(container.querySelector('.display-value').textContent).toBe('Hi Roy');
    fireEvent.change(getByTestId("the-input"), {
        target: { value: "New Value" }
    });
    expect(container.querySelector('.display-value').textContent).toBe('New Value');
});
`}

</SyntaxHighlighter>
